import { User } from "firebase/auth";
import { collection, collectionGroup, doc, setDoc, getDocs, onSnapshot, orderBy, query, QuerySnapshot, DocumentData, deleteField, updateDoc } from "firebase/firestore";
import { db } from "./firebase";

export const saveEvent = (user: User, event: object) => {
    setDoc(doc(collection(db, 'users', user.uid, 'events')), event);
}

export const getOwnEvents = (user: User) => {
    return getDocs(query(collection(db, 'users', user.uid, 'events'), orderBy('date')));
}

export const getAllEvents = () => {
    return getDocs(query(collectionGroup(db, 'events'), orderBy('date')));
}

export const listenAllEvents = (callback: (event: QuerySnapshot<DocumentData>) => void) => (
    onSnapshot(
        query(collectionGroup(db, 'events'), orderBy('date')),
        (snapshot) => (callback(snapshot))
    )
)

export const joinEvent = (creatorId: string, eventId: string, user: User) => {

    return updateDoc(doc(db, 'users', creatorId, 'events', eventId), 'interested.'+user.uid, {
        userId: user.uid,
        displayName: user.displayName || 'Anonymous User',
        photoURL: user.photoURL || 'data:image/jpg;base64,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',
        isAnonymous: user.isAnonymous
    });

}

export const leaveEvent = (creatorId: string, eventId: string, user: User) => {

    return updateDoc(doc(db, 'users', creatorId, 'events', eventId), 'interested.'+user.uid, deleteField());

}